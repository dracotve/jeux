<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pixel Art Game - The Riddle</title>
    <style>
        body {
            margin: 0;
            background: black;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            color: white;
            font-family: 'Courier New', Courier, monospace;
        }

        canvas {
            border: 2px solid white;
            image-rendering: pixelated;
            display: none;
        }

        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
            z-index: 30;
        }

        #loading-overlay {
            background: url('https://i.imgur.com/5Xn347S.png') no-repeat center center / cover;
            z-index: 100;
        }

        .loader-text {
            font-size: 2em;
            background: rgba(0,0,0,0.7);
            padding: 20px;
            border: 2px solid white;
        }

        #story-text, #space-riddle-text {
            line-height: 1.6;
            max-width: 700px;
            white-space: pre-line;
            font-size: 1.2em;
        }

        #game-over-text {
            font-size: 4em;
            color: red;
            font-weight: bold;
            display: none;
        }

        #main-menu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://i.imgur.com/nqK5nxv.png') no-repeat center center / cover;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            z-index: 20;
            padding: 50px;
            box-sizing: border-box;
        }

        .btn {
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: 2px solid white;
            padding: 15px 30px;
            cursor: pointer;
            font-family: 'Courier New', Courier, monospace;
            font-size: 1.1em;
            transition: 0.3s;
            margin: 10px;
        }

        .btn:hover { background: white; color: black; }

        #choices-container, #space-choices { display: none; margin-top: 20px; gap: 10px; }

        #admin-tools {
            position: absolute;
            top: 10px;
            right: 10px;
            display: none;
            z-index: 40;
            flex-direction: column;
        }
        
        .admin-btn {
            padding: 8px;
            font-size: 0.7em;
            margin-bottom: 5px;
            background: rgba(255, 0, 0, 0.5);
            border: 1px solid white;
            color: white;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div id="main-menu">
    <h1 style="font-size: 3.5em; text-shadow: 3px 3px 10px black;">THE CAR CAN CHANGE YOUR LIFE</h1>
    <div style="display: flex; gap: 20px; align-self: flex-end;">
        <button id="credits-btn" class="btn">CREDITS</button>
        <button id="play-button" class="btn">PLAY</button>
    </div>
</div>

<div id="loading-overlay" class="overlay">
    <div class="loader-text" id="loader-msg">LOADING IN PROGRESS...</div>
</div>

<div id="credits-overlay" class="overlay">
    <h1>CREDITS</h1>
    <p>GUERIN Alexis<br>JEAND'HEUR Liam<br>BEUGRE - - MARBOUA Hinno-Jhunior<br>GALLOIS Nolan</p>
    <button id="close-credits" class="btn">BACK</button>
</div>

<div id="story-overlay" class="overlay">
    <p id="story-text"></p>
    <button id="start-game-button" class="btn">START ADVENTURE</button>
    <div id="choices-container">
        <button class="btn choice-btn" data-city="EVERGLADES">EVERGLADES</button>
        <button class="btn choice-btn" data-city="KENNEDY SPACE CENTER">KENNEDY SPACE CENTER</button>
        <button class="btn choice-btn" data-city="JACKSONVILLE">JACKSONVILLE</button>
    </div>
</div>

<div id="space-riddle-overlay" class="overlay" style="background: black; z-index: 50;">
    <p id="space-riddle-text"></p>
    <div id="space-choices">
        <button class="btn space-choice-btn" data-answer="JACKSONVILLE">JACKSONVILLE</button>
        <button class="btn space-choice-btn" data-answer="MIAMI">MIAMI</button>
        <button class="btn space-choice-btn" data-answer="TAMPA">TAMPA</button>
    </div>
</div>

<div id="game-over-overlay" class="overlay" style="background: black;">
    <p id="wrong-road-msg" style="font-size: 1.5em; color: white;"></p>
    <h2 id="game-over-text">GAME OVER</h2>
</div>

<div id="admin-tools">
    <button id="cheat-btn" class="admin-btn">CHEAT: +1000 MILES</button>
    <button id="skip-to-riddle" class="admin-btn">SKIP TO RIDDLE</button>
</div>

<canvas id="game" width="800" height="450"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const mainMenu = document.getElementById("main-menu");
const loadingOverlay = document.getElementById("loading-overlay");
const loaderMsg = document.getElementById("loader-msg");
const storyOverlay = document.getElementById("story-overlay");
const storyText = document.getElementById("story-text");
const choicesContainer = document.getElementById("choices-container");
const adminTools = document.getElementById("admin-tools");
const gameOverOverlay = document.getElementById("game-over-overlay");
const gameOverText = document.getElementById("game-over-text");
const wrongRoadMsg = document.getElementById("wrong-road-msg");
const spaceOverlay = document.getElementById("space-riddle-overlay");
const spaceText = document.getElementById("space-riddle-text");
const spaceChoices = document.getElementById("space-choices");

// === ASSETS ===
const background = new Image(); background.src = "https://i.imgur.com/1iPHzZk.png";
const evergladesBg = "https://i.imgur.com/lmv1lGB.png"; 
const kennedyBg = "https://i.imgur.com/jXkox1h.png"; 
const jacksonvilleBg = "https://i.imgur.com/WJNGXmW.png";
const tampaBg = "https://i.imgur.com/TQoi5jU.png";
const miamiBg = "https://i.imgur.com/1iPHzZk.png";
const playerIdle = new Image(); playerIdle.src = "https://i.imgur.com/SvsfsiA.png";
const playerWalk = new Image(); playerWalk.src = "https://i.imgur.com/0eb0KYR.png";
const carImg = new Image(); carImg.src = "https://i.imgur.com/y7EmwQ0.png";
const bushImg = new Image(); bushImg.src = "https://i.imgur.com/krm21gr.png";

// === GAME STATE ===
let player = { x: 150, y: 370, targetX: 150, targetY: 370, speed: 2.5, moving: false, inCar: false };
let car = { x: 500, y: 260, width: 124, height: 134, speed: 6 };
let cameraX = 0;
let gameEnded = false;
let isLoading = false;
let selectedCity = "";

// --- LOGIQUE BOUTONS ---
document.getElementById("play-button").onclick = () => {
    mainMenu.style.display = "none";
    loaderMsg.innerText = "LOADING IN PROGRESS...";
    loadingOverlay.style.display = "flex";
    setTimeout(() => {
        loadingOverlay.style.display = "none";
        storyOverlay.style.display = "flex";
        storyText.innerText = `Your father organized a treasure hunt for you with a big surprise. For this, he gave you a simple rule: you have a paper in your mailbox, you read it once 1000 mile from your starting point. You will soon know where you have to start because a red car is waiting for you.`;
    }, 5000);
};

document.getElementById("start-game-button").onclick = () => {
    storyOverlay.style.display = "none";
    canvas.style.display = "block";
    adminTools.style.display = "flex";
    gameLoop();
};

document.getElementById("cheat-btn").onclick = () => { 
    player.x += 20005; 
    player.targetX = player.x; 
};

document.getElementById("skip-to-riddle").onclick = () => {
    selectedCity = "EVERGLADES";
    player.x = 20005;
    player.targetX = 20005;
};

function triggerEnding() {
    gameEnded = true;
    adminTools.style.display = "none";
    storyOverlay.style.display = "flex";
    document.getElementById("start-game-button").style.display = "none";
    storyText.innerText = "You open the glove box and find a paper and you decide to read it.......";
    setTimeout(() => {
        storyText.innerText = `Look like water attraction, you can see trees on this place, this place is more bigger than Boca Grande. There is a beautiful view when you are in the water attraction. You can see animals like bird and fishes. On the water they are waterlillies. Can you find me? Where I am ?`;
        choicesContainer.style.display = "flex";
    }, 3000);
}

document.querySelectorAll(".choice-btn").forEach(btn => {
    btn.onclick = (e) => {
        selectedCity = e.target.getAttribute("data-city");
        choicesContainer.style.display = "none";
        storyOverlay.style.display = "none";
        
        // ANCIEN CHARGEMENT
        loaderMsg.innerText = "ON THE WAY TO " + selectedCity + "...";
        loadingOverlay.style.display = "flex";
        isLoading = true;
        
        setTimeout(() => {
            loadingOverlay.style.display = "none";
            isLoading = false;
            gameEnded = false;
            car.x = 100; car.y = 260;
            player.x = car.x + 60; player.y = car.y + 60;
            player.targetX = player.x; player.targetY = player.y;
            player.inCar = true;
            cameraX = 0;

            if (selectedCity === "EVERGLADES") background.src = evergladesBg;
            else if (selectedCity === "KENNEDY SPACE CENTER") background.src = kennedyBg;
            else if (selectedCity === "JACKSONVILLE") background.src = jacksonvilleBg;
            
            adminTools.style.display = "flex";
        }, 5000); 
    };
});

document.querySelectorAll(".space-choice-btn").forEach(btn => {
    btn.onclick = (e) => {
        const choice = e.target.getAttribute("data-answer");
        spaceOverlay.style.display = "none";
        
        // ANCIEN CHARGEMENT
        loaderMsg.innerText = "ON THE WAY TO " + choice + "...";
        loadingOverlay.style.display = "flex";
        isLoading = true;

        setTimeout(() => {
            loadingOverlay.style.display = "none";
            isLoading = false;
            gameEnded = false;
            player.x = 100; player.targetX = 100; cameraX = 0;
            car.x = 50; car.y = 260;

            if (choice === "MIAMI") {
                selectedCity = "MIAMI";
                background.src = miamiBg;
            } else if (choice === "JACKSONVILLE") {
                selectedCity = "JACKSONVILLE";
                background.src = jacksonvilleBg;
            } else if (choice === "TAMPA") {
                selectedCity = "TAMPA";
                background.src = tampaBg;
            }
        }, 5000);
    };
});

function handleGameOver(msg) {
    gameEnded = true;
    wrongRoadMsg.innerText = msg;
    gameOverOverlay.style.display = "flex";
    setTimeout(() => {
        gameOverText.style.display = "block";
        setTimeout(() => { location.reload(); }, 5000);
    }, 5000);
}

function update() {
    if (isLoading || gameEnded) return;

    if (!player.inCar) {
        let dx = player.targetX - player.x;
        let dy = player.targetY - player.y;
        let dist = Math.sqrt(dx*dx + dy*dy);
        if (dist > 2) {
            player.x += (dx/dist) * player.speed;
            player.y += (dy/dist) * player.speed;
            player.moving = true;
        } else {
            player.moving = false;
            if (Math.abs(player.x - (car.x + 60)) < 30) player.inCar = true;
        }
    } else {
        let dx = (player.targetX - 60) - car.x;
        let dy = (player.targetY - 60) - car.y;
        let dist = Math.sqrt(dx*dx + dy*dy);
        if (dist > 5) {
            car.x += (dx/dist) * car.speed;
            car.y += (dy/dist) * car.speed;
        }
        player.x = car.x + 60; player.y = car.y + 60;
    }

    cameraX += (player.x - 400 - cameraX) * 0.1;
    let currentMiles = Math.floor(player.x / 20);

    if (selectedCity === "" && currentMiles >= 1000) triggerEnding();

    if (selectedCity === "EVERGLADES" && currentMiles >= 1000) {
        gameEnded = true;
        spaceOverlay.style.display = "flex";
        spaceText.innerText = `You need to go on the most popular museum based on the space history. This place is popular like Disneyland.\n\nOnce the protagonist came here with his dad when he was a kid in this space station. He saw his dad hiding a broken map in a strange box.\n\nCan you find it ?`;
        spaceChoices.style.display = "flex";
    }

    if (selectedCity === "JACKSONVILLE" && currentMiles >= 40) {
        handleGameOver("This path leads nowhere... Jacksonville doesn't hold the secret.");
    }

    if (selectedCity === "TAMPA" && currentMiles >= 40) {
        handleGameOver("Tampa was a dead end. You are lost.");
    }
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if (isLoading) return;

    ctx.save();
    ctx.translate(-cameraX, 0);

    for (let i = -1; i <= 100; i++) {
        ctx.drawImage(background, i * 800, 0, 800, 450);
    }
    
    if (selectedCity === "") {
        for (let j = 1; j <= 20; j++) ctx.drawImage(bushImg, j * 1000, 250, 120, 120);
    }

    ctx.drawImage(carImg, car.x, car.y, car.width, car.height);
    if (!player.inCar) ctx.drawImage(player.moving ? playerWalk : playerIdle, player.x - 16, player.y - 16, 32, 32);
    ctx.restore();

    ctx.textAlign = "left";
    ctx.fillStyle = "rgba(0,0,0,0.7)"; ctx.fillRect(10, 10, 200, 30);
    ctx.fillStyle = "white"; ctx.font = "14px Arial";
    ctx.fillText(`Distance: ${Math.floor(player.x / 20)} miles`, 20, 30);
}

function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

canvas.addEventListener("click", (e) => {
    if (gameEnded || isLoading) return;
    const rect = canvas.getBoundingClientRect();
    player.targetX = e.clientX - rect.left + cameraX;
    let y = e.clientY - rect.top;
    player.targetY = Math.max(305, Math.min(370, y));
});

document.getElementById("credits-btn").onclick = () => document.getElementById("credits-overlay").style.display = "flex";
document.getElementById("close-credits").onclick = () => document.getElementById("credits-overlay").style.display = "none";
</script>
</body>
</html>